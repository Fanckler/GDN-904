# twig-extended-loader
Расширенный загрузчик Twig.js шаблонов для Webpack. Загрузчик позволяет подключать
Twig шаблоны, предназначенные для изпользования с Symfony. Является форком [этого](https://github.com/zimmo-be/twig-loader)
загрузчика.

## Установка
`npm install twig-extended-loader`

В корневой папке приложения создать файл ```twig.config.js``` со следующим содержимым:
```javascript
module.exports = {
    define: {
        ASSET_BASE_PATH: JSON.stringify('/base/path/to/assets'),
        ASSET_BASE_URL: JSON.stringify('<base URL to assets>'),
        DOMAIN: JSON.stringify('<http://domain:port>'),
    },
    renderExclude: []
};
```
_renderExclude_ - массив шаблонов и директорий шаблоны из которых не должны рендериться как самостоятельные страницы.
Каждый элемент массива должен быть в формате допустимым для функции glob.

## Использование с Encore
### Подключение загрузчика
```javascript
Encore.addLoader({
    test: /\.twig$/,
    loader: 'twig-extended-loader',
    options: {
        templateRoot: './src/twig/templates',
        testDataRoot: './src/twig/dataTest',
    }
}); 
```
_templateRoot_ - корневая папка с Twig шаблонами  
_testDataRoot_ - корневая папка с тестовыми данными для подстановки в шаблоны. Структура файлов должна повторять структуру
в _templateRoot_. Имена файлов с данными должны соответствовать именам шаблонов, за исключением расширения - вместо '.html.twig'
следует использовать '.js'. Например, для шаблона index.html.twig файл с данными должен быть index.js

### Определение правил маршрутизации
Для определения правил маршрутизации необходимо в директории, на которую ссылается _testDataRoot_ создать файл ```_route_rules.js```   
Пример содержимого файла _router_rules.js:
```javascript
module.exports = {
    main: {
        prefix: '',
        path: '/'
    },
    ladies_gallery : {
        prefix: '',
        path: '/ladies-gallery/'
    },
    chatv3: {
        prefix: '',
        path: '/chat_v3/'
    }
};
```
Ключи первого уровня (в примере это main, ladies_gallery, chatv3) являются именами правил маршрутизации. Общий принцип построения
итогового URL выглядит следующим образом: DOMAIN/prefix/path?query,   
где _query_ - это GET-параметры, передаваемые в запрос   

Подключить роуты:
```javascript
Encore.addPlugin(
    new webpack.ProvidePlugin({
        routerRules: __dirname+'/'+testDataRoot+'/_route_rules',
    })
);
```

### Определение констант локализации (переводы)
Для определения констант локализации необходимо в директории, на которую ссылается _testDataRoot_ создать файл ```_translate_messages.js```
в следующем формате:
```javascript
module.exports = {
    domain: {
        locale:{
            code1: value1,
            code2: value2
        }
    }
};
```

Подключить файл переводов:
```javascript
Encore.addPlugin(
    new webpack.ProvidePlugin({
        messages: __dirname+'/'+testDataRoot+'/_translate_messages',
    })
);
```
