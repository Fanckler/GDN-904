'use strict';

class DeleteUnusedEntriesJSPlugin{
    constructor(entriesToDelete = []){
        this.entriesToDelete = entriesToDelete;
    }

    apply(compiler){
        compiler.hooks.emit.tapAsync('DeleteUnusedEntriesLSPlugin', (compilation, callback) => {
            compilation.chunks.forEach((chunk) => {
                if(this.entriesToDelete.includes(chunk.name)) {
                    chunk.files.forEach((file) => {
                        if (/\.[a-z0-9]*\.js$/.test(file)) {
                            delete compilation.assets[file]
                            chunk.files.splice(chunk.files.indexOf(file), 1);
                        }
                    });
                }
            });

            callback();
        });
    }
}

module.exports = DeleteUnusedEntriesJSPlugin;